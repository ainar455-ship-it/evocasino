import { getAllCasinoSlugs, getCasinoBySlug, getOffersForCasinoId } from "@/lib/queries/casino";
import { renderStars } from "@/utils/ratings";

type Casino = {
  id: string;
  name: string;
  slug: string;
  out_url: string;
  rating?: number;
  reviewCount?: number;
  license?: string;
  established?: number;
};

type Offer = {
  id: string;
  casino_id: string;
  type: "free_spins" | "deposit_bonus";
  title: string;
  spins?: number;
  bonus?: string;
  wagering: string;
  min_deposit_zar: number;
  max_cashout_zar: number;
  cta: string;
  source_url?: string;
  last_verified_at?: string;
};


interface PageProps {
  params: Promise<{ slug: string }>;
}

export async function generateStaticParams() {
  return getAllCasinoSlugs().map((slug) => ({ slug }));
}

export async function generateMetadata({ params }: PageProps) {
  const { slug } = await params;
  const casino = getCasinoBySlug(slug);
  return {
    title: `${casino?.name || 'Casino'} Review | FreeSpinsCasinoZA`,
    description: `Detailed review of ${casino?.name || 'casino'} - free spins, bonuses, payment methods, and more.`,
  };
}

export default async function CasinoReviewPage({ params }: PageProps) {
  const { slug } = await params;
  const casino = getCasinoBySlug(slug);
  const casinoOffers = casino ? getOffersForCasinoId(casino.id) : [];
  const freeSpinsOffers = casinoOffers.filter((o) => o.type === "free_spins");
  const depositBonusOffers = casinoOffers.filter((o) => o.type === "deposit_bonus");

  if (!casino) {
    return (
      <main className="min-h-screen bg-gray-50">
        <div className="mx-auto max-w-6xl px-4 py-10">
          <div className="rounded-lg border border-gray-200 bg-white p-12 text-center">
            <h1 className="text-2xl font-bold text-gray-900">Casino not found</h1>
            <p className="mt-2 text-gray-600">The casino you&apos;re looking for doesn&apos;t exist.</p>
            <a href="/" className="mt-4 inline-block rounded-lg bg-green-600 px-6 py-3 text-sm font-semibold text-white">
              Back to Home
            </a>
          </div>
        </div>
      </main>
    );
  }

  return (
    <main className="min-h-screen bg-gray-50">
      {/* Disclosure bar */}
      <div className="sticky top-0 z-50 w-full border-b-2 border-green-500 bg-white/95 backdrop-blur">
        <div className="mx-auto max-w-6xl px-4 py-2 text-center text-xs text-gray-700">
          <span className="font-semibold text-green-600">18+</span> ‚Ä¢ T&Cs apply ‚Ä¢ Play responsibly ‚Ä¢ This site contains affiliate links
        </div>
      </div>

      {/* Hero */}
      <section className="mx-auto max-w-6xl px-4 py-10">
        <a href="/" className="mb-4 inline-block text-sm text-green-600 hover:text-green-700 font-semibold">
          ‚Üê Back to all casinos
        </a>

        <div className="rounded-lg bg-white p-8 border border-gray-200 shadow-sm">
          <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-6">
            <div className="flex-1">
              <h1 className="text-4xl font-bold text-gray-900">{casino.name}</h1>
              <div className="mt-4">
                {renderStars(casino.rating, true, 'lg')}
              </div>
              {casino.established && (
                <p className="mt-4 text-sm text-gray-600">
                  <span className="font-semibold">Established:</span> {casino.established}
                </p>
              )}
              {casino.license && (
                <p className="mt-2 text-sm text-gray-600">
                  <span className="font-semibold">License:</span> {casino.license}
                </p>
              )}
            </div>

            <div className="flex flex-col gap-3">
              <a
                href={casino.affiliateLink}
                target="_blank"
                rel="noreferrer"
                className="rounded-lg bg-green-600 px-6 py-3 text-center text-sm font-semibold text-white shadow-md hover:bg-green-700 hover:shadow-lg transition duration-200"
              >
                Play Now
              </a>
              <a
                href={casino.affiliateLink}
                target="_blank"
                rel="noreferrer"
                className="rounded-lg border border-gray-300 bg-white px-6 py-3 text-center text-sm font-semibold text-gray-800 hover:border-gray-400 hover:shadow transition duration-200"
              >
                Visit Site
              </a>
            </div>
          </div>
        </div>
      </section>

      {/* Available Offers */}
      <section className="mx-auto max-w-6xl px-4 py-10">
        <h2 className="text-2xl font-bold text-gray-900 mb-6">Available Offers at {casino.name}</h2>

        <div className="grid gap-6 md:grid-cols-2">
          {/* Free Spins */}
          {freeSpinsOffers.length > 0 && (
            <div className="rounded-lg border border-gray-200 bg-white p-6">
              <h3 className="text-lg font-bold text-gray-900 mb-4">üé∞ Free Spins Offers</h3>
              <div className="space-y-4">
                {freeSpinsOffers.map((offer) => (
                  <div key={offer.id} className="border-b pb-4 last:border-b-0">
                    <h4 className="font-semibold text-gray-900">{offer.title}</h4>
                    {typeof offer.spins === "number" && (
                      <p className="mt-2 text-2xl font-bold text-green-600">{offer.spins} Spins</p>
                    )}
                    <div className="mt-3 space-y-1 text-sm text-gray-600">
                      <p><span className="font-semibold">Wagering:</span> {offer.wagering}</p>
                      <p><span className="font-semibold">Min Deposit:</span> R{offer.min_deposit_zar}</p>
                      <p><span className="font-semibold">Max Cashout:</span> R{offer.max_cashout_zar}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Deposit Bonuses */}
          {depositBonusOffers.length > 0 && (
            <div className="rounded-lg border border-gray-200 bg-white p-6">
              <h3 className="text-lg font-bold text-gray-900 mb-4">üí∞ Deposit Bonuses</h3>
              <div className="space-y-4">
                {depositBonusOffers.map((offer) => (
                  <div key={offer.id} className="border-b pb-4 last:border-b-0">
                    <h4 className="font-semibold text-gray-900">{offer.title}</h4>
                    {typeof offer.bonus === "string" && (
                      <p className="mt-2 text-2xl font-bold text-amber-600">{offer.bonus}</p>
                    )}
                    <div className="mt-3 space-y-1 text-sm text-gray-600">
                      <p><span className="font-semibold">Wagering:</span> {offer.wagering}</p>
                      <p><span className="font-semibold">Min Deposit:</span> R{offer.min_deposit_zar}</p>
                      <p><span className="font-semibold">Max Cashout:</span> R{offer.max_cashout_zar}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        {casinoOffers.length === 0 && (
          <div className="rounded-lg border border-gray-200 bg-white p-12 text-center">
            <p className="text-gray-600">No offers currently available for {casino.name}.</p>
          </div>
        )}
      </section>

      {/* Features & Payment Methods */}
      <section className="mx-auto max-w-6xl px-4 py-10">
        <div className="grid gap-6 md:grid-cols-2">
          <div className="rounded-lg border border-gray-200 bg-white p-6">
            <h3 className="text-lg font-bold text-gray-900 mb-4">Casino Features</h3>
            <ul className="space-y-2 text-sm text-gray-700">
              <li className="flex items-center gap-2"><span className="text-green-600 font-bold">‚úì</span> Licensed & Regulated</li>
              <li className="flex items-center gap-2"><span className="text-green-600 font-bold">‚úì</span> Mobile App Available</li>
              <li className="flex items-center gap-2"><span className="text-green-600 font-bold">‚úì</span> Fast Payouts (24-48 hours)</li>
              <li className="flex items-center gap-2"><span className="text-green-600 font-bold">‚úì</span> 24/7 Customer Support</li>
              <li className="flex items-center gap-2"><span className="text-green-600 font-bold">‚úì</span> Responsible Gambling Tools</li>
            </ul>
          </div>

          <div className="rounded-lg border border-gray-200 bg-white p-6">
            <h3 className="text-lg font-bold text-gray-900 mb-4">Payment Methods Accepted</h3>
            <div className="flex flex-wrap gap-2">
              <img src="/images/payments/ozow.svg" alt="Ozow" className="h-10 w-auto rounded border border-gray-200" loading="lazy" />
              <img src="/images/payments/sid.svg" alt="SID Instant EFT" className="h-10 w-auto rounded border border-gray-200" loading="lazy" />
              <img src="/images/payments/visa.svg" alt="Visa" className="h-10 w-auto rounded border border-gray-200" loading="lazy" />
              <img src="/images/payments/mastercard.svg" alt="Mastercard" className="h-10 w-auto rounded border border-gray-200" loading="lazy" />
              <img src="/images/payments/bitcoin.svg" alt="Bitcoin" className="h-10 w-auto rounded border border-gray-200" loading="lazy" />
            </div>
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="mx-auto max-w-6xl px-4 py-10">
        <div className="rounded-lg bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 p-8 text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-3">Ready to Play at {casino.name}?</h2>
          <p className="text-gray-600 mb-6">Start claiming bonuses and free spins today. 18+ Only. Play Responsibly.</p>
          <a
            href={casino.affiliateLink}
            target="_blank"
            rel="noreferrer"
            className="inline-block rounded-lg bg-green-600 px-8 py-4 text-sm font-semibold text-white shadow-md hover:bg-green-700 hover:shadow-lg transition duration-200"
          >
            Play at {casino.name} Now
          </a>
        </div>
      </section>

      {/* Footer */}
      <footer className="border-t bg-white mt-12">
        <div className="mx-auto max-w-6xl px-4 py-8">
          <div className="grid gap-6 md:grid-cols-3">
            <div>
              <div className="text-sm font-semibold text-gray-900">Trust & Safety</div>
              <div className="mt-2 space-y-1 text-xs text-gray-600">
                <div>18+ only. Play responsibly.</div>
                <div>Terms & conditions apply.</div>
                <div>Licensed by Western Cape Gambling Board</div>
              </div>
            </div>
            <div>
              <div className="text-sm font-semibold text-gray-900">Quick Links</div>
              <div className="mt-2 space-y-1 text-xs">
                <div><a href="/" className="text-green-600 hover:text-green-700">All Casinos</a></div>
                <div><a href="/bonuses/free-spins" className="text-green-600 hover:text-green-700">Free Spins</a></div>
                <div><a href={casino.affiliateLink} target="_blank" rel="noreferrer" className="text-green-600 hover:text-green-700">{casino.name} Site</a></div>
              </div>
            </div>
            <div>
              <div className="text-sm font-semibold text-gray-900">About Us</div>
              <div className="mt-2 text-xs text-gray-600">
                This site contains affiliate links. We may earn a commission if you sign up via our links. All reviews are independent.
              </div>
            </div>
          </div>
          <div className="mt-8 border-t pt-6 text-center text-xs text-gray-500">
            ¬© 2026 FreeSpinsCasinoZA.co.za ‚Äî All rights reserved.
          </div>
        </div>
      </footer>
    </main>
  );
}
