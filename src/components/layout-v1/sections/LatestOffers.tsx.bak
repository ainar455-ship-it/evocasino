import { Button } from "@/components/layout-v1/primitives/Button";
import { Card } from "@/components/layout-v1/primitives/Card";
import { Container } from "@/components/layout-v1/primitives/Container";
import { Badge } from "@/components/layout-v1/primitives/Badge";

type Offer = {
  id: string;
  title?: string;
  casinoId: string;
  casinoName: string;
  casinoSlug: string;
  affiliateLink: string;
  lastVerifiedAt?: string | null;
};

type Props = {
  offers: Offer[];
};

function formatVerified(date?: string | null) {
  if (!date) return null;
  const ts = Date.parse(date);
  if (Number.isNaN(ts)) return null;
  return new Date(ts).toLocaleDateString("en-ZA", { year: "numeric", month: "short", day: "numeric" });
}

export function LatestOffers({ offers }: Props) {
  if (!offers?.length) return null;

  return (
    <section id="latest-offers" className="pb-10">
      <Container className="max-w-6xl">
        <div className="flex flex-wrap items-end justify-between gap-3">
          <div>
            <h2 className="text-2xl font-bold text-gray-900">Latest offers</h2>
            <p className="mt-1 text-sm text-gray-600">Most recently verified promotions</p>
          </div>
        </div>

        <div className="mt-6 space-y-4">
          {offers.map((o) => {
            const verified = formatVerified(o.lastVerifiedAt);

            return (
              <Card key={o.id} className="p-5">
                <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                  <div className="flex items-start gap-4">
                    <div className="flex h-12 w-32 items-center justify-center overflow-hidden rounded border border-gray-200 bg-white p-2">
                      <img
                        src={`/images/casinos/${o.casinoId}.svg`}
                        alt={`${o.casinoName} logo`}
                        className="max-h-full max-w-full object-contain"
                        loading="lazy"
                        width="128"
                        height="48"
                      />
                    </div>

                    <div className="min-w-0">
                      <div className="flex flex-wrap items-center gap-2">
                        <h3 className="text-lg font-bold text-gray-900">{o.casinoName}</h3>
                        {verified && <Badge variant="neutral">Verified: {verified}</Badge>}
                      </div>

                      <p className="mt-1 text-sm text-gray-700">{o.title ?? "Offer available now"}</p>

                      <div className="mt-2">
                        <Button href={`/casinos/${o.casinoSlug}`} variant="ghost">
                          View details
                        </Button>
                      </div>
                    </div>
                  </div>

                  <div className="flex flex-col gap-2 sm:w-56">
                    <Button href={o.affiliateLink} variant="primary">
                      Play now
                    </Button>
                    <Button href={`/casinos/${o.casinoSlug}`} variant="secondary">
                      Read full review
                    </Button>
                  </div>
                </div>
              </Card>
            );
          })}
        </div>
      </Container>
    </section>
  );
}
